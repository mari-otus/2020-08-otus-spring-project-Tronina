<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="header.html" />

<body>
<h1>Список броней</h1>
<table class="bookings" border="1">
    <thead>
    <tr>
        <th>id</th>
        <th>Название комнаты</th>
        <th>Логин пользователя</th>
        <th>Дата и время начала брони</th>
        <th>Дата и время окончания брони</th>
        <th></th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<br/>
<td>
    <a href="/bookings/add">Добавить бронь</a>
</td>
<script>
    function remove(id) {
        $.ajax({
            type: 'DELETE',
            url: `/api/bookings/${id}`,
            data: id,
            contentType: "application/json",
            success: function (bookings) {
                $('tbody').empty();
                appendTbody(bookings);
            },
            error: function (result) {
                alert(result.responseJSON.message);
            }
        });
    }

    $(function () {
        $.ajax({
            type: 'POST',
            url: "/api/bookings/search",
            data: JSON.stringify({}),
            dataType: "json",
            contentType: "application/json",
            success: function (bookings) {
                appendTbody(bookings);
            },
            error: function (result) {
                alert(result.responseJSON.message);
            }
        });

    });

    function appendTbody(bookings) {
        bookings.forEach(function (booking) {
            $('tbody').append(`
                    <tr>
                        <td>${booking.id}</td>
                        <td>${booking.roomName}</td>
                        <td>${booking.login}</td>
                        <td>${new Date(booking.beginDate).toLocaleString("ru-RU")}</td>
                        <td>${new Date(booking.endDate).toLocaleString("ru-RU")}</td>
                        <td>
                            <a href="/bookings/${booking.id}">Редактировать</a>
                        </td>
                        <td>
                            <button type="button" onclick="remove(${booking.id})">Удалить</button>
                        </td>
                    </tr>
                `)
        });
    }
</script>
</body>
</html>